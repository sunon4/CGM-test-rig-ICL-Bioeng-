{
    # Global options
    admin off
    auto_https disable_redirects
}

:80 {
    # Development configuration
    handle /api/* {
        uri strip_prefix /api
        reverse_proxy api:8000
    }

    handle /ws/* {
        uri strip_prefix /ws
        reverse_proxy api:8000
    }

    handle /* {
        reverse_proxy frontend:3000
    }

    log {
        output stdout
        format console
    }
}

# Production configuration (uncomment and modify for your domain)
# pump-control.yourdomain.com {
#     reverse_proxy /api/* api:8000 {
#         uri strip_prefix /api
#     }
#     
#     reverse_proxy /ws/* api:8000 {
#         uri strip_prefix /ws
#     }
#
#     reverse_proxy /* frontend:3000
#
#     tls {
#         protocols tls1.2 tls1.3
#     }
#
#     log {
#         output stdout
#         format console
#     }
# } 